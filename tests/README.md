# TypeScript Anchor Tests

The goal of these tests is to provide positive and negative cases for account annotations and custom errors in the Solana World ID program.

- [x] [initialize](/programs/solana-world-id-program/src/instructions/initialize.rs)
  - [x] Successfully initializes
  - [x] Rejects deployer account mismatch
  - [x] Rejects without deployer as signer
  - [x] Rejects incorrect program_data
  - [x] Rejects duplicate initialization
- [x] [post_signatures](/programs/solana-world-id-program/src/instructions/post_signatures.rs)
  - [x] Successfully posts signatures
  - [x] Successfully appends signatures
  - [x] Rejects append by non-initial payer
- [x] [update_root_with_query](/programs/solana-world-id-program/src/instructions/update_root_with_query.rs)
  - [x] Successfully verifies mock queries and updates root
  - [x] Successfully closed the signature set
  - [x] Successfully verifies a mainnet quorum amount of signatures
  - [x] Successfully verifies and updates subsequent root
  - [x] Rejects valid root which already exists
  - [x] Rejects guardian set account not owned by the core bridge
  - [x] Rejects guardian set account mismatch
  - [x] Rejects refund recipient account mismatch
  - [x] Rejects root hash instruction argument mismatch
  - [x] Rejects expired guardian set
  - [x] Rejects no quorum
  - [x] Rejects out of order guardian signatures (InvalidGuardianIndex)
  - [x] Rejects duplicate guardian signatures (InvalidGuardianIndex)
  - [x] Rejects guardian index out of bounds (InvalidGuardianIndex)
  - [x] Rejects invalid signature (InvalidSignature)
  - [x] Rejects invalid message hash (InvalidGuardianKeyRecovery)
  - [x] Rejects un-parse-able response
  - [x] Rejects invalid number of requests
  - [x] Rejects invalid request chain id
  - [x] Rejects invalid request type
  - [x] Rejects invalid request call data length
  - [x] Rejects invalid request contract
  - [x] Rejects invalid request signature
  - [x] Rejects invalid number of responses (defense-in-depth)
  - [x] Rejects invalid response chain id (defense-in-depth)
  - [x] Rejects invalid response type (defense-in-depth)
  - [x] Rejects stale block number
  - [x] Rejects stale block time
  - [x] Rejects invalid response results length
  - [x] Rejects invalid response result length
- [x] [clean_up_root](/programs/solana-world-id-program/src/instructions/clean_up_root.rs)
  - [x] Successfully cleans up an expired root
  - [x] Rejects non root account
  - [x] Rejects refund recipient account mismatch
  - [x] Rejects active root clean up
- [x] [close_signatures](/programs/solana-world-id-program/src/instructions/close_signatures.rs)
  - [x] Successfully closes signature accounts
  - [x] Rejects refund recipient account mismatch
  - [x] Rejects without refund recipient as signer
- [ ] [transfer_ownership](/programs/solana-world-id-program/src/instructions/admin.rs)
  - [ ] Successfully initiates ownership transfer (test in devnet)
  - [x] Rejects owner account mismatch
  - [x] Rejects without owner as signer
  - [x] Rejects incorrect program_data
  - [ ] Rejects when authority is already upgrade lock (test in devnet)
- [ ] [claim_ownership](/programs/solana-world-id-program/src/instructions/admin.rs)
  - [ ] Successfully completes ownership transfer (test in devnet)
  - [ ] Successfully cancels ownership transfer (test in devnet)
  - [x] Rejects when upgrade_lock is not upgrade_authority_address
  - [x] Rejects owner or pending owner account mismatch
  - [x] Rejects without owner or pending owner as signer
  - [x] Rejects incorrect program_data
- [x] [set_root_expiry](/programs/solana-world-id-program/src/instructions/admin.rs)
  - [x] Successfully updates expiry config
  - [x] Rejects owner account mismatch
  - [x] Rejects without owner as signer
- [x] [set_allowed_update_staleness](/programs/solana-world-id-program/src/instructions/admin.rs)
  - [x] Successfully updates staleness config
  - [x] Rejects owner account mismatch
  - [x] Rejects without owner as signer
- [x] [verify_groth16_proof](/programs/solana-world-id-program/src/instructions/admin.rs)
  - [x] Successfully verifies a valid groth16 proof
  - [x] Rejects root hash without a corresponding PDA
  - [x] Rejects root hash instruction argument mismatch
  - [x] Rejects verification type instruction argument mismatch
  - [x] Rejects an expired root
  - [x] Rejects an invalid proof
